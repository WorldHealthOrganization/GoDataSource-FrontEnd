<!-- Common -->
<ng-template
  #commonPart
  let-option="option">
  <div
    class="gd-main-menu-option-label"
    fxLayout="row">

    <!-- Icon -->
    <div
      fxGrow="0"
      class="material-icons gd-main-menu-option-label-icon">{{option.icon}}</div>

    <!-- label -->
    <div
      fxFlex
      class="gd-main-menu-option-label-text">
      {{option.label | translate}}
    </div>
  </div>
</ng-template>

<!-- Menu -->
<mat-accordion
  class="gd-main-menu"
  [class.gd-version-not-visible]="!expanded || !versionData"
  displayMode="flat">

  <!-- Menu options -->
  <ng-container
    *ngFor="let group of menuGroups">
    <ng-container
      *ngIf="group.visible">

      <!-- Label -->
      <div
        class="gd-main-menu-group-label">
        <ng-container
          *ngIf="expanded">
          {{group.label | translate}}
        </ng-container>
      </div>

      <!-- Children -->
      <ng-container
        *ngFor="let menuOption of group.options">
        <ng-container
          *ngIf="menuOption.visible">

          <!-- Menu without children - link -->
          <div
            *ngIf="menuOption.link; else childrenPanel"
            class="gd-main-menu-option gd-main-menu-option-link"
            [routerLink]="menuOption.link"
            routerLinkActive="gd-main-menu-option-active"
            [routerLinkActiveOptions]="activeSetup">
            <div
              class="gd-main-menu-option-header">
              <ng-template
                [ngTemplateOutlet]="commonPart"
                [ngTemplateOutletContext]="{ option: menuOption }"></ng-template>
            </div>
          </div>

          <!-- Menu with children -->
          <ng-template
            #childrenPanel>

            <!-- Panel -->
            <mat-expansion-panel
              *ngIf="expanded; else floatingMenu"
              class="gd-main-menu-option">

              <!-- Menu Header -->
              <mat-expansion-panel-header
                class="gd-main-menu-option-header">
                <mat-panel-title>
                  <ng-template
                    [ngTemplateOutlet]="commonPart"
                    [ngTemplateOutletContext]="{ option: menuOption }"></ng-template>
                </mat-panel-title>
              </mat-expansion-panel-header>

              <!-- Children when menu is expanded -->
              <div
                class="gd-main-menu-option-children">
                <ng-container
                  *ngFor="let menuOptionChild of menuOption.children">
                  <ng-container
                    *ngIf="menuOptionChild.visible">

                    <!-- Child Menu link -->
                    <div
                      class="gd-main-menu-option gd-main-menu-option-link"
                      [routerLink]="menuOptionChild.link"
                      routerLinkActive="gd-main-menu-option-active"
                      [routerLinkActiveOptions]="activeSetup">
                      <div
                        class="gd-main-menu-option-header">
                        <ng-template
                          [ngTemplateOutlet]="commonPart"
                          [ngTemplateOutletContext]="{ option: menuOptionChild }"></ng-template>
                      </div>
                    </div>

                  </ng-container>
                </ng-container>
              </div>

            </mat-expansion-panel>

            <!-- Floating menu -->
            <ng-template
              #floatingMenu>

              <!-- Icon -->
              <div
                class="gd-main-menu-option"
                [matMenuTriggerFor]="menu"
                (menuOpened)="mainMenuOpened()">
                <div
                  class="gd-main-menu-option-header">
                  <ng-template
                    [ngTemplateOutlet]="commonPart"
                    [ngTemplateOutletContext]="{ option: menuOption }"></ng-template>
                </div>
              </div>

              <!-- Floating menu -->
              <mat-menu
                #menu="matMenu"
                class="gd-main-menu-option-float-menu">
                <ng-container
                  *ngFor="let menuOptionChild of menuOption.children">
                  <ng-container
                    *ngIf="menuOptionChild.visible">

                    <!-- Child Menu link -->
                    <button
                      class="gd-main-menu-option-header-button"
                      mat-menu-item
                      [routerLink]="menuOptionChild.link"
                      routerLinkActive="gd-main-menu-option-active"
                      [routerLinkActiveOptions]="activeSetup">
                      <ng-template
                        [ngTemplateOutlet]="commonPart"
                        [ngTemplateOutletContext]="{ option: menuOptionChild }"></ng-template>
                    </button>

                  </ng-container>
                </ng-container>
              </mat-menu>
            </ng-template>

          </ng-template>
        </ng-container>
      </ng-container>
    </ng-container>
  </ng-container>
</mat-accordion>

<!-- Version -->
<div
  *ngIf="expanded && versionData"
  class="gd-version">
  {{ 'LNG_LAYOUT_MENU_VERSION_LABEL' | translate: { version: versionData.version, build: versionData.build } }}
</div>

<!--
<div class="sidenav" fxLayout="column">

    <div class="item account-item" fxLayout="row">
        <mat-menu #menu="matMenu" xPosition="before" yPosition="below">
            <ng-container
                *ngFor="let childItem of accountItem.children">
                <button
                    *ngIf="shouldDisplayItem(childItem)"
                    mat-menu-item
                    [routerLink]="[childItem.link]">
                    {{childItem.label | translate}}
                </button>
            </ng-container>
        </mat-menu>

        <button fxFlex mat-button color="primary" [matMenuTriggerFor]="menu">

            <div class="item-content" fxLayout="row" fxLayoutAlign="space-between center">

                <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">

                    <span class="xt-icon">{{accountItem.icon}}</span>

                    <div class="item-name" fxLayout="column" fxLayoutAlign="center start">
                        <div class="user-name">
                            {{authUser.firstName}} {{authUser.lastName}}
                        </div>
                        <div class="user-email">
                            {{authUser.email}}
                        </div>
                    </div>
                </div>

                <span class="xt-icon expand">thinArrowDown</span>
            </div>

        </button>
    </div>
</div>
-->
