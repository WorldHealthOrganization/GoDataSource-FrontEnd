<app-topnav>
    <ng-container dynamic-section>
        <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
            <app-breadcrumbs [items]="breadcrumbs"></app-breadcrumbs>
        </div>
    </ng-container>
</app-topnav>

<mat-card class="page-section page-content" fxLayout="column">
    <!-- Filters -->
    <div>
        <!-- Date range filter -->
        <app-form-date-range-slider
            *ngIf="selectedOutbreak"
            name="dateRangeFilter"
            [ngModel]="sliderDateFilterValue"
            [minDate]="slideFilterData.minDate"
            [maxDate]="slideFilterData.maxDate"
            [maxRange]="slideFilterData.maxRange"
            [label]="'LNG_PAGE_LIST_TEAMS_LABEL_DATE' | translate"
            tooltip="LNG_PAGE_LIST_TEAMS_LABEL_DATE_DESCRIPTION"
            (optionChanged)="filterByDateRange($event)">
        </app-form-date-range-slider>
    </div>

    <!-- Loading data -->
    <div
        *ngIf="displayLoading"
        class="team-workload-loading">
        <mat-spinner></mat-spinner>
    </div>

    <!-- Team workload -->
    <div
        *ngIf="!displayLoading"
        fxLayout="row">

        <div
            *ngIf="dates && dates.length > 0; else noData"
            class="workload-table-wrapper">
            <table class="team-workload-table">
                <tr>
                    <th *ngFor="let date of dates">
                        {{ date }}
                    </th>
                </tr>
                <tr *ngFor="let teamData of teamsDataShow">
                    <td *ngFor="let date of dates; let first = first">
                        <ng-container
                            *ngIf="first">
                            <span
                                [matTooltip]="teamData.name">
                                {{ teamData.name }}
                            </span>
                        </ng-container>
                        <div
                            *ngIf="!first">
                            <a
                                class="team-workload-link"
                                routerLink="/contacts/follow-ups" [queryParams]="{
                                    fromWorkload: true,
                                    date: date,
                                    team: teamData.id ?
                                        teamData.id :
                                        '',
                                    status: ['LNG_REFERENCE_DATA_CONTACT_DAILY_FOLLOW_UP_STATUS_TYPE_SEEN_OK', 'LNG_REFERENCE_DATA_CONTACT_DAILY_FOLLOW_UP_STATUS_TYPE_SEEN_NOT_OK']
                                }">
                                {{ teamData.dates[date] ? teamData.dates[date].successfulFollowupsCount : 0 }}
                            </a>
                            {{ 'LNG_PAGE_TEAMS_WORKLOAD_TABLE_OF_LABEL' | translate }}
                            <a
                                class="team-workload-link"
                                routerLink="/contacts/follow-ups" [queryParams]="{
                                    fromWorkload: true,
                                    date: date,
                                    team: teamData.id ?
                                        teamData.id :
                                        ''
                                }">
                                {{ teamData.dates[date] ? teamData.dates[date].totalFollowupsCount : 0 }}
                            </a>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- No data -->
        <ng-template
            #noData>
            <div
                fxFlex
                class="empty-table-text">
                {{'LNG_COMMON_LABEL_EMPTY_TABLE' | translate}}
            </div>
        </ng-template>
    </div>

</mat-card>
