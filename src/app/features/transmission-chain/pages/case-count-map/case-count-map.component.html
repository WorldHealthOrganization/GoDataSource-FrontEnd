<app-topnav [activeOutbreakEditable]="false">
    <ng-container dynamic-section>
        <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
            <app-breadcrumbs [items]="breadcrumbs"></app-breadcrumbs>

            <div class="topnav-actions">

                <button
                    *ngIf="TransmissionChainModel.canExportCaseCountMap(authUser)"
                    mat-raised-button color="accent"
                    [matMenuTriggerFor]="quickActionsMenu">
                    {{'LNG_COMMON_BUTTON_QUICK_ACTIONS' | translate}} <span class="xt-icon">arrowDown</span>
                </button>

                <mat-menu #quickActionsMenu="matMenu">
                    <button
                        *ngIf="TransmissionChainModel.canExportCaseCountMap(authUser)"
                        mat-menu-item
                        (click)="exportCaseCountMap()">
                        {{'LNG_PAGE_CASE_COUNT_EXPORT_MAP' | translate}}
                    </button>
                </mat-menu>
            </div>
        </div>
    </ng-container>
</app-topnav>

<mat-card
    class="page-section page-content"
    fxLayout="column"
>
    <div
        class="app-case-count-map-filters"
        fxLayout="column"
    >
        <!-- panel toggle -->
        <div fxLayout="row" fxLayoutAlign="space-between center">
            <!-- settings toggle -->
            <button
                mat-raised-button
                (click)="showSettings = !showSettings">
                {{ 'LNG_PAGE_CASE_COUNT_MAP_BUTTON_CONFIGURE_SETTINGS' | translate }}
            </button>
        </div>

        <!-- settings panel -->
        <div
            *ngIf="showSettings"
            fxLayout="column"
        >
            <!-- Filters -->
            <app-transmission-chain-filters
                title="LNG_PAGE_CASE_COUNT_MAP_FILTERS_TITLE"
                [filters]="filters">
            </app-transmission-chain-filters>

            <!-- Buttons -->
            <div fxLayout="row" fxFlexAlign="end" fxLayoutGap="10px">
                <!-- Reset filters -->
                <button
                    fxFlex="150px"
                    mat-raised-button
                    (click)="resetFilters()">
                    {{ 'LNG_PAGE_CASE_COUNT_MAP_BUTTON_RESET_FILTERS' | translate }}
                </button>

                <!-- Apply filters -->
                <button
                    fxFlex="150px"
                    mat-raised-button
                    color="accent"
                    (click)="reloadCases()">
                    {{ 'LNG_PAGE_CASE_COUNT_MAP_BUTTON_APPLY_SETTINGS' | translate }}
                </button>
            </div>
        </div>
    </div>

    <div fxLayout="row" fxLayoutGap="20px">
        <div fxFlex="200px">
            {{ 'LNG_PAGE_CASE_COUNT_MAP_DISTANCE_LABEL' | translate }} ( {{ clusterDistance }} )
        </div>
        <mat-slider
            fxFlex
            [min]="10"
            [max]="150"
            [(ngModel)]="clusterDistance"
            [tickInterval]="10">
        </mat-slider>
    </div>

    <!-- Count map -->
    <app-world-map
        *ngIf="markers.length > 0"
        #worldMap
        width="100%"
        height="500px"
        [markers]="markers"
        [fitMapOnMarkersChange]="false"
        [centerLocation]="markers[0]?.point"
        [displayLoading]="displayLoading"
        [fitLayer]="WorldMapMarkerLayer.CLUSTER"
        [clusterDistance]="clusterDistance">
    </app-world-map>

    <!-- No data -->
    <div
        *ngIf="markers.length < 1">
        {{ 'LNG_PAGE_CASE_COUNT_MAP_NO_DATA' | translate }}
    </div>
</mat-card>
