<div class="chain-settings">
    <div
        fxFlex fxLayout="row" fxLayoutAlign="space-between center">
        <!-- settings toggle -->
        <button
            mat-raised-button
            (click)="toggleSettings()">
            {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_BUTTON_CONFIGURE_SETTINGS' | translate }}
        </button>

        <!-- Date - moment in time -->
        <div
            fxFlex="150px">
            <app-form-datepicker
                class="global-date-filter"
                [(ngModel)]="dateGlobalFilter"
                [placeholder]="'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_FILTER_DATE' | translate"
                [tooltip]="'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_FILTER_DESCRIPTION' | translate"
                (optionChanged)="onChangeGlobalDate()">
            </app-form-datepicker>
        </div>
    </div>

    <!-- settings panel -->
    <div
        *ngIf="showSettings"
        fxFlex fxLayout="column"
        class="settings-container">

        <div
            fxFlex fxLayout="row" fxLayoutGap="10px">
            <!-- entity type filter - events -->
            <app-form-checkbox
                fxFlex="150px"
                name="showEvents"
                label="Show Events"
                [(ngModel)]="filters.showEvents">
            </app-form-checkbox>

            <!-- entity type filter - contacts -->
            <app-form-checkbox
                fxFlex="150px"
                name="showContacts"
                label="Show Contacts"
                [(ngModel)]="filters.showContacts">
            </app-form-checkbox>
        </div>

        <div
            fxFlex fxLayout="row wrap" fxLayoutGap="20px">
            <!-- Filters -->
            <mat-card
                fxFlex fxLayout="column" fxLayoutGap="20px">
                <div
                    fxFlex
                    class="settings-container-title">
                    {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_FILTERS_TITLE' | translate }}
                </div>

                <div
                    fxFlex fxLayout="row" fxLayoutGap="20px">
                    <!-- case classification -->
                    <app-form-select
                        name="classification"
                        [(ngModel)]="filters.classification"
                        [placeholder]="'LNG_CASE_FIELD_LABEL_CLASSIFICATION' | translate"
                        [options]="caseClassificationsList$ | async">
                    </app-form-select>

                    <!-- occupation -->
                    <app-form-select
                        name="occupation"
                        [(ngModel)]="filters.occupation"
                        [placeholder]="'LNG_CONTACT_FIELD_LABEL_OCCUPATION' | translate"
                        [options]="occupationsList$ | async">
                    </app-form-select>
                </div>

                <div
                    fxFlex fxLayout="row" fxLayoutGap="20px">
                    <!-- first name -->
                    <app-form-input
                        name="firstName"
                        [(ngModel)]="filters.firstName"
                        [placeholder]="'LNG_CONTACT_FIELD_LABEL_FIRST_NAME' | translate"
                        maxlength="100">
                    </app-form-input>

                    <!-- last name -->
                    <app-form-input
                        name="lastName"
                        [(ngModel)]="filters.lastName"
                        [placeholder]="'LNG_CONTACT_FIELD_LABEL_LAST_NAME' | translate"
                        maxlength="100">
                    </app-form-input>
                </div>

                <div
                    fxFlex fxLayout="row" fxLayoutGap="20px">
                    <!-- gender -->
                    <app-form-select
                        name="gender"
                        [(ngModel)]="filters.gender"
                        [placeholder]="'LNG_CASE_FIELD_LABEL_GENDER' | translate"
                        [options]="genderList$ | async"
                        multiple="true">
                    </app-form-select>

                    <!-- location -->
                    <app-form-location-dropdown
                        name="locationId"
                        [(ngModel)]="filters.locationId"
                        [useOutbreakLocations]="true"
                        [placeholder]="'LNG_ADDRESS_FIELD_LABEL_LOCATION' | translate">
                    </app-form-location-dropdown>
                </div>

                <!-- Age -->
                <div
                    fxFlex fxLayout="column" fxLayoutGap="10px">
                    <div
                        fxFlex>
                        {{ 'LNG_ENTITY_FIELD_LABEL_AGE' | translate }}
                    </div>

                    <app-form-range
                        name="age"
                        [ngModel]="filters.age"
                        (changed)="setAgeFilter($event)">
                    </app-form-range>
                </div>

                <!-- Date -->
                <div
                    fxFlex fxLayout="column" fxLayoutGap="10px">
                    <div
                        fxFlex>
                        {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_LABEL_DATE' | translate }}
                    </div>

                    <app-form-daterange
                        name="date"
                        [ngModel]="filters.date"
                        (changed)="setDateFilter($event)">
                    </app-form-daterange>
                </div>
            </mat-card>

            <!-- Right Side => Node Settings & Edge Settings -->
            <div
                fxFlex fxLayout="column" fxLayoutGap="20px">
                <!-- Node Settings -->
                <mat-card
                    fxFlex fxLayout="column" fxLayoutGap="10px">
                    <div
                        fxFlex
                        class="settings-container-title">
                        {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NODE_SETTINGS_TITLE' | translate }}
                    </div>

                    <!-- Node Label -->
                    <div
                        fxFlex fxLayout="column">
                        <div
                            fxFlex>
                            {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NODE_LABEL_TITLE' | translate }}
                        </div>

                        <app-form-radio
                            name="nodeLabelCriteria"
                            [(ngModel)]="colorCriteria.nodeLabelCriteria"
                            [options]="nodeLabelCriteriaOptions$ | async">
                        </app-form-radio>
                    </div>

                    <!-- Node Label Color -->
                    <div
                        fxFlex fxLayout="column">
                        <div
                            fxFlex>
                            {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NODE_NAME_COLOR_TITLE' | translate }}
                        </div>

                        <app-form-radio
                            name="nodeNameColorCriteria"
                            [(ngModel)]="colorCriteria.nodeNameColorCriteria"
                            [options]="nodeColorCriteriaOptions$ | async">
                        </app-form-radio>
                    </div>

                    <!-- Node Color -->
                    <div
                        fxFlex fxLayout="column">
                        <div
                            fxFlex>
                            {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NODE_COLOR_TITLE' | translate }}
                        </div>

                        <app-form-radio
                            name="nodeColorCriteria"
                            [(ngModel)]="colorCriteria.nodeColorCriteria"
                            [options]="nodeColorCriteriaOptions$ | async">
                        </app-form-radio>
                    </div>

                    <!-- Node Icon -->
                    <div
                        fxFlex fxLayout="column">
                        <div
                            fxFlex>
                            {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NODE_ICON_TITLE' | translate }}
                        </div>

                        <app-form-radio
                            name="nodeIconCriteria"
                            [(ngModel)]="colorCriteria.nodeIconCriteria"
                            [options]="nodeIconCriteriaOptions$ | async">
                        </app-form-radio>
                    </div>
                </mat-card>

                <!-- Edge Settings -->
                <mat-card
                    fxFlex fxLayout="column" fxLayoutGap="10px">
                    <div
                        fxFlex
                        class="settings-container-title">
                        {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_EDGE_SETTINGS_TITLE' | translate }}
                    </div>

                    <!-- Edge Label -->
                    <div
                        fxFlex fxLayout="column">
                        <div
                            fxFlex>
                            {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_EDGE_LABEL_TITLE' | translate }}
                        </div>

                        <app-form-radio
                            name="edgeLabelCriteria"
                            [(ngModel)]="colorCriteria.edgeLabelCriteria"
                            [options]="edgeLabelCriteriaOptions$ | async">
                        </app-form-radio>
                    </div>

                    <!-- Edge Color -->
                    <div
                        fxFlex fxLayout="column">
                        <div
                            fxFlex>
                            {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_EDGE_COLOR_TITLE' | translate }}
                        </div>

                        <app-form-radio
                            name="edgeColorCriteria"
                            [(ngModel)]="colorCriteria.edgeColorCriteria"
                            [options]="edgeColorCriteriaOptions$ | async">
                        </app-form-radio>
                    </div>
                </mat-card>
            </div>
        </div>

        <div
            fxFlex fxLayout="row" fxFlexAlign="end" fxLayoutGap="10px">
            <!-- Reset filters -->
            <button
                fxFlex="150px"
                mat-raised-button
                (click)="resetFilters()">
                {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_BUTTON_RESET_SETTINGS' | translate }}
            </button>

            <!-- Apply filters -->
            <button
                fxFlex="150px"
                mat-raised-button
                color="accent"
                (click)="refreshChain()">
                {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_BUTTON_APPLY_SETTINGS' | translate }}
            </button>
        </div>
    </div>
</div>

<!-- cytoscape element -->
<app-cytoscape-graph
    [elements]="graphElements"
    [transmissionChainViewType]="selectedViewType"
    [legend]="legend"
    (nodeTapped)="onNodeTap($event)"
    (edgeTapped)="onEdgeTap($event)"
    (viewTypeChanged)="viewTypeChanged($event)">
</app-cytoscape-graph>
<div *ngIf="sizeOfChainsFilter">
    <div>
        {{'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_CHAINS_FILTERED_BY_SIZE' | translate}} {{sizeOfChainsFilter}}
    </div>
    <button mat-raised-button (click)="resetChain()">
        {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_RESET_CHAINS' | translate }}
    </button>
</div>
<div *ngIf="personId">
    <div>
        {{'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_CHAINS_FILTERED_BY_PERSON' | translate}} {{personName}}
    </div>
    <button mat-raised-button (click)="resetChain()">
        {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_RESET_CHAINS' | translate }}
    </button>
</div>
