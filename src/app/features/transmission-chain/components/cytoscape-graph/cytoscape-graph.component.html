<div class="cytoscape-graph-container">
    <!-- dropdown with view types -->
    <app-form-select
        name="chainView"
        [(ngModel)]="transmissionChainViewType"
        required="true"
        [options]="transmissionChainViewTypes$ | async"
        (optionChanged)="updateView($event)"
        [clearable]="false">
    </app-form-select>

    <!-- spinner -->
    <div class="spinner-graph"
         *ngIf="showLoading">
        <mat-spinner></mat-spinner>
    </div>

    <!-- legend -->
    <div class="graph-legend"
         *ngIf="legend && showLegend && (transmissionChainViewType !== Constants.TRANSMISSION_CHAIN_VIEW_TYPES.GEOSPATIAL_MAP.value || markers.length > 0)">
        <!-- node color -->
        <div *ngIf="legend.nodeColorKeys && legend.nodeColorKeys.length"
             class="legend-name">
            {{'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NODE_COLOR_TITLE' | translate}}
            <div class="legend-field-name">{{legend.nodeColorLabel | translate}}:</div>
        </div>
        <div
            *ngFor="let nodeColorItem of legend.nodeColorKeys" class="legend-item">
            <div
                class="legend-color"
                [style.background-color]="legend.nodeColor[nodeColorItem]">
            </div>
            <div>
                {{nodeColorItem | translate}}
            </div>
        </div>

        <!-- node name color -->
        <div *ngIf="legend.nodeNameColorKeys && legend.nodeNameColorKeys.length"
             class="legend-name">
            {{'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NODE_NAME_COLOR_TITLE' | translate}}
            <div class="legend-field-name">{{legend.nodeNameColorLabel | translate}}:</div>
        </div>
        <div
            *ngFor="let nodeNameColorItem of legend.nodeNameColorKeys" class="legend-item">
            <div
                class="legend-color"
                [style.background-color]="legend.nodeNameColor[nodeNameColorItem]">
            </div>
            <div>
                {{nodeNameColorItem | translate}}
            </div>
            <div *ngIf="transmissionChainViewType == Constants.TRANSMISSION_CHAIN_VIEW_TYPES.TIMELINE_NETWORK.value
            || transmissionChainViewType == Constants.TRANSMISSION_CHAIN_VIEW_TYPES.TIMELINE_NETWORK_LAST_CONTACT.value
            || transmissionChainViewType == Constants.TRANSMISSION_CHAIN_VIEW_TYPES.TIMELINE_NETWORK_REPORTING.value">
                - {{legend.nodeNameColorAdditionalInfo[nodeNameColorItem] | translate}}
            </div>
        </div>

        <!-- edge color -->
        <div *ngIf="legend.edgeColorKeys && legend.edgeColorKeys.length"
             class="legend-name">
            {{'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_EDGE_COLOR_TITLE' | translate}}
            <div class="legend-field-name">{{legend.edgeColorLabel | translate}}:</div>
        </div>
        <div
            *ngFor="let edgeColorItem of legend.edgeColorKeys" class="legend-item">
            <div
                class="legend-color"
                [style.background-color]="legend.edgeColor[edgeColorItem]">
            </div>
            <div>
                {{edgeColorItem | translate}}
            </div>
        </div>

        <!-- node icon -->
        <div *ngIf="legend.nodeIconKeys && legend.nodeIconKeys.length"
             class="legend-name">
            {{'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NODE_ICON_TITLE' | translate}}
            <div class="legend-field-name">{{legend.nodeIconLabel | translate}}:</div>
        </div>
        <div
            *ngFor="let nodeIconItem of legend.nodeIconKeys" class="legend-item">
            <div
                class="legend-icon"
                [style.background-image]="'url(' + legend.nodeIcon[nodeIconItem] + ')'">
            </div>
            <div>
                {{nodeIconItem | translate}}
            </div>
        </div>

        <!-- node shape -->
        <div *ngIf="legend.nodeShapeKeys && legend.nodeShapeKeys.length"
             class="legend-name">
            {{'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NODE_SHAPE_TITLE' | translate}}
            <div class="legend-field-name">{{legend.nodeShapeLabel | translate}}:</div>
        </div>
        <div
            *ngFor="let nodeShapeItem of legend.nodeShapeKeys" class="legend-item">
            <span class="xt-icon">{{legend.nodeShape[nodeShapeItem]}}</span>
            <div>
                {{nodeShapeItem | translate}}
            </div>
        </div>

        <!-- edge icon -->
        <div *ngIf="legend.edgeIconKeys && legend.edgeIconKeys.length"
             class="legend-name">
            {{'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_EDGE_ICON_TITLE' | translate}}
            <div class="legend-field-name">{{legend.edgeIconLabel | translate}}:</div>
        </div>
        <div
            *ngFor="let edgeIconItem of legend.edgeIconKeys" class="legend-item">
            <span class="xt-icon">{{legend.edgeIcon[edgeIconItem]}}</span>
            <div>
                {{edgeIconItem | translate}}
            </div>
        </div>

    </div>

    <!-- Toggles -->
    <div
        *ngIf="!showLoading && (transmissionChainViewType !== Constants.TRANSMISSION_CHAIN_VIEW_TYPES.GEOSPATIAL_MAP.value || markers.length > 0)"
        class="graph-actions" fxLayout="row" fxLayoutGap="30px">

        <!-- Toggle Edit mode -->
        <app-form-slide-toggle
            *ngIf="isEditModeAvailable()"
            name="toggleEditMode"
            [label]="'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_TOGGLE_EDIT_MODE_LABEL' | translate"
            [(ngModel)]="editMode"
            (optionChanged)="toggleEditMode()"
        ></app-form-slide-toggle>

        <!-- Display Labels -->
        <app-form-slide-toggle
            *ngIf="transmissionChainViewType === Constants.TRANSMISSION_CHAIN_VIEW_TYPES.GEOSPATIAL_MAP.value"
            name="displayLabels"
            [(ngModel)]="displayLabels"
            [label]="'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_TOGGLE_DISPLAY_MARKER_LABELS_LABEL' | translate">
        </app-form-slide-toggle>

        <!-- Show / hide legend -->
        <app-form-slide-toggle
            name="showLegend"
            [label]="'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_SHOW_LEGEND_LABEL' | translate"
            [(ngModel)]="showLegend">
        </app-form-slide-toggle>

    </div>

    <div
        [fxShow]="!showLoading && transmissionChainViewType !== Constants.TRANSMISSION_CHAIN_VIEW_TYPES.GEOSPATIAL_MAP.value">
        <!-- zoom in / out buttons -->
        <div
            class="cy-zoom-buttons">
            <button
                mat-raised-button
                class="cy-zoom-button"
                [disableRipple]="true"
                (click)="zoomInGraph()">
                +
            </button>
            <br />
            <button
                mat-raised-button
                class="cy-zoom-button"
                [disableRipple]="true"
                (click)="zoomOutGraph()">
                -
            </button>
        </div>

        <!-- cytoscape element -->
        <div
            id="cy"
            class="cy xt-icon">
        </div>
    </div>

    <!-- Geospatial map -->
    <div
        *ngIf="!showLoading && transmissionChainViewType === Constants.TRANSMISSION_CHAIN_VIEW_TYPES.GEOSPATIAL_MAP.value">
        <!-- Geospatial map -->
        <app-world-map
            *ngIf="markers.length > 0"
            width="100%"
            height="500px"
            [markers]="markers"
            [lines]="lines"
            [displayLabels]="displayLabels"
            [fitMapOnMarkersChange]="false"
            [centerLocation]="markers[0]?.point"
            [fitLayer]="WorldMapMarkerLayer.CLUSTER"
            [clusterDistance]="30"
            groupMarkerTitle="LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_GROUP_DIALOG_MARKER_SECTION_TITLE"
            groupPathTitle="LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_GROUP_DIALOG_PATHS_SECTION_TITLE">
        </app-world-map>

        <!-- No data -->
        <div
            *ngIf="markers.length < 1"
            class="geo-map-no-data">
            <span>
                {{ 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_NO_DATA' | translate }}
            </span>
        </div>
    </div>
</div>

<div *ngIf="showCaseNodesWithoutDates()"
     class="entities-no-dates">
    <a target="_blank"
       routerLink="/cases"
       [queryParams]="{applyListFilter: getCasesListFilter(), caseIds: elements.caseNodesWithoutDates}">
        {{elements.caseNodesWithoutDates.length}}
        {{ getCasesWithoutDatesTitle() | translate}}
    </a>
</div>
<div *ngIf="showContactNodesWithoutDates()"
     class="entities-no-dates">
    <a target="_blank"
       routerLink="/contacts"
       [queryParams]="{applyListFilter: getContactsListFilter(), contactIds: elements.caseNodesWithoutDates}">
        {{elements.contactNodesWithoutDates.length}}
        {{ getContactsWithoutDatesTitle() | translate}}
    </a>
</div>
<div *ngIf="showEventNodesWithoutDates()"
     class="entities-no-dates">
    <a target="_blank"
       routerLink="/events"
       [queryParams]="{applyListFilter: getEventsListFilter(), eventIds: elements.eventNodesWithoutDates}">
        {{elements.eventNodesWithoutDates.length}}
        {{ getEventsWithoutDatesTitle() | translate}}
    </a>
</div>

<button *ngIf="( transmissionChainViewType == Constants.TRANSMISSION_CHAIN_VIEW_TYPES.TIMELINE_NETWORK.value
        || transmissionChainViewType == Constants.TRANSMISSION_CHAIN_VIEW_TYPES.TIMELINE_NETWORK_LAST_CONTACT.value
        || transmissionChainViewType == Constants.TRANSMISSION_CHAIN_VIEW_TYPES.TIMELINE_NETWORK_REPORTING.value)"
    mat-raised-button
    (click)="switchTimelineView(timelineViewType === 'horizontal' ? 'vertical' : 'horizontal')">
    {{ ( timelineViewType === 'horizontal' ? 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_BUTTON_CHANGE_TIMELINE_VIEW_VERTICAL' : 'LNG_PAGE_GRAPH_CHAINS_OF_TRANSMISSION_BUTTON_CHANGE_TIMELINE_VIEW_HORIZONTAL' )| translate }}
</button>
