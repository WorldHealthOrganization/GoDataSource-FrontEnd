<div
  class="gd-form-edit-questionnaire-v2">

  <!-- Top -->
  <div
    *ngIf="!viewOnly"
    class="gd-form-edit-questionnaire-v2-top"
    fxLayoutAlign="end">
    <button
      type="button"
      mat-flat-button
      color="primary"
      (click)="addQuestion(undefined)">
      {{'LNG_QUESTIONNAIRE_TEMPLATE_QUESTION_BUTTON_ADD_NEW' | translate}}
    </button>
  </div>

  <!-- Records -->
  <div
    class="gd-form-edit-questionnaire-v2-list">

    <!-- Records -->
    <ng-container
      *ngIf="flattenedQuestions?.length > 0; else noQuestions">
      <cdk-virtual-scroll-viewport
        #cdkViewport
        class="gd-form-edit-questionnaire-v2-list-{{name}}"
        cdkDropList [cdkDropListData]="flattenedQuestions" [cdkDropListSortPredicate]="canDrop" (cdkDropListDropped)="dropItem($event)"
        [minBufferPx]="maxBufferPx ? maxBufferPx : bufferToRender"
        [maxBufferPx]="maxBufferPx ? maxBufferPx : bufferToRender"

        change123
        [itemSize]="32"
        style="height: 350px">

        <!-- Item -->
        <div
          *cdkVirtualFor="let item of flattenedQuestions; templateCacheSize: 0"
          class="gd-form-edit-questionnaire-v2-item"
          cdkDrag cdkDragLockAxis="y" cdkDragBoundary=".gd-form-edit-questionnaire-v2-list-{{name}}" [cdkDragData]="item" [cdkDragDisabled]="viewOnly" (cdkDragStarted)="dragStarted($event)"
          [ngSwitch]="item.type"

          change123
          [style.paddingLeft.px]="item.level * 20"
          style="height: 32px">

          <!-- Question -->
          <div
            *ngSwitchCase="FlattenType.QUESTION"
            class="gd-form-edit-questionnaire-v2-item-question"
            [class.gd-form-edit-questionnaire-v2-item-question-inactive]="item.data.inactive"

            change123
            fxLayout="row">

            <!-- Sort -->
            <mat-icon
              *ngIf="!viewOnly"
              cdkDragHandle
              (mousedown)="notInvalidDragZone()">drag_indicator</mat-icon>

            <!-- Type -->
            <mat-icon
              change123
              fxGrow="0">help_center</mat-icon>

            <!-- Label & icons -->
            <div
              change123
              fxFlex>

              <!-- Label -->
              <span>{{item.data.text}}</span>

              <!-- Icons -->
              <span
                *ngIf="renderMode !== RenderMode.SMALL">

                <!-- Multiple answers -->
                <mat-icon
                  *ngIf="item.data.multiAnswer">format_list_numbered_rtl</mat-icon>

                <!-- Required -->
                <mat-icon
                  *ngIf="item.data.required">stars</mat-icon>

                <!-- Inactive -->
                <mat-icon
                  *ngIf="item.data.inactive"
                  color="warn">do_not_disturb</mat-icon>
              </span>

            </div>

            <!-- Buttons -->
            <div
              change123
              fxGrow="0">

              <!-- Add answer -->
              <button
                *ngIf="!viewOnly && item.canHaveChildren"
                type="button"
                mat-icon-button
                [matTooltip]="'LNG_QUESTIONNAIRE_TEMPLATE_QUESTION_ANSWER_BUTTON_ADD_NEW' | translate"
                (click)="addAnswer(item.data)">
                <mat-icon>text_increase</mat-icon>
              </button>

              <!-- Edit question -->
              <button
                type="button"
                mat-icon-button
                [matTooltip]="'LNG_COMMON_BUTTON_UPDATE' | translate"
                (click)="viewEditQuestion(item.data)">
                <mat-icon>{{viewOnly ? 'visibility' : 'edit'}}</mat-icon>
              </button>

            </div>

          </div>

          <!-- Answer -->
          <div
            *ngSwitchCase="FlattenType.ANSWER"
            class="gd-form-edit-questionnaire-v2-item-answer"

            change123
            fxLayout="row">

            <!-- Sort -->
            <mat-icon
              *ngIf="!viewOnly"
              cdkDragHandle
              (mousedown)="notInvalidDragZone()">drag_indicator</mat-icon>

            <!-- Type -->
            <mat-icon
              change123
              fxGrow="0">font_download</mat-icon>

            <!-- Label & icons -->
            <div
              change123
              fxFlex>

              <!-- Label -->
              <span>{{item.data.label}}</span>

              <!-- Icons -->
              <span
                *ngIf="renderMode !== RenderMode.SMALL">
                <!-- Alert -->
                <mat-icon
                  *ngIf="item.data.alert">notification_important</mat-icon>
              </span>

            </div>

            <!-- Buttons -->
            <div
              change123
              fxGrow="0">

              <!-- Add question -->
              <button
                *ngIf="!viewOnly"
                type="button"
                mat-icon-button
                [matTooltip]="'LNG_QUESTIONNAIRE_TEMPLATE_QUESTION_BUTTON_ADD_NEW' | translate"
                (click)="addQuestion(item.data)">
                <mat-icon>add_comment</mat-icon>
              </button>

              <!-- Edit answer -->
              <button
                type="button"
                mat-icon-button
                [matTooltip]="'LNG_COMMON_BUTTON_UPDATE' | translate"
                (click)="viewEditAnswer(item.data, item.parent.data)">
                <mat-icon>{{viewOnly ? 'visibility' : 'edit'}}</mat-icon>
              </button>

            </div>

          </div>

        </div>

      </cdk-virtual-scroll-viewport>
    </ng-container>

    <!-- No questions image -->
    <ng-template
      #noQuestions>
      <div>
        empty list image....
      </div>
    </ng-template>
  </div>

  <!-- Legend -->
  <div
    *ngIf="flattenedQuestions?.length > 0"
    class="gd-form-edit-questionnaire-v2-legend">

    <!-- Header -->
    <div
      class="gd-form-edit-questionnaire-v2-legend-title">
      {{'LNG_COMMON_LABEL_LEGEND' | translate}}
    </div>

    <!-- Items -->
    <div
      class="gd-form-edit-questionnaire-v2-legend-items">

      <!-- Drag -->
      <div
        *ngIf="!viewOnly"
        class="gd-form-edit-questionnaire-v2-legend-items-item">
        <mat-icon>drag_indicator</mat-icon>
        <span>{{'LNG_COMMON_BUTTON_DRAG' | translate}}</span>
      </div>

      <!-- Multiple answers -->
      <div
        class="gd-form-edit-questionnaire-v2-legend-items-item">
        <mat-icon>format_list_numbered_rtl</mat-icon>
        <span>{{'LNG_QUESTIONNAIRE_TEMPLATE_QUESTION_FIELD_LABEL_MULTI_ANSWER' | translate}}</span>
      </div>

      <!-- Required -->
      <div
        class="gd-form-edit-questionnaire-v2-legend-items-item">
        <mat-icon>stars</mat-icon>
        <span>{{'LNG_QUESTIONNAIRE_TEMPLATE_QUESTION_FIELD_LABEL_REQUIRED' | translate}}</span>
      </div>

      <!-- Inactive -->
      <div
        class="gd-form-edit-questionnaire-v2-legend-items-item">
        <mat-icon
          color="warn">do_not_disturb</mat-icon>
        <span>{{'LNG_QUESTIONNAIRE_TEMPLATE_QUESTION_FIELD_LABEL_INACTIVE' | translate}}</span>
      </div>

      <!-- Alert -->
      <div
        class="gd-form-edit-questionnaire-v2-legend-items-item">
        <mat-icon>notification_important</mat-icon>
        <span>{{'LNG_QUESTIONNAIRE_TEMPLATE_QUESTION_ANSWER_FIELD_LABEL_ALERT' | translate}}</span>
      </div>

      <!-- Add question -->
      <div
        *ngIf="!viewOnly"
        class="gd-form-edit-questionnaire-v2-legend-items-item">
        <mat-icon>add_comment</mat-icon>
        <span>{{'LNG_QUESTIONNAIRE_TEMPLATE_QUESTION_BUTTON_ADD_NEW' | translate}}</span>
      </div>

      <!-- Add answers -->
      <div
        *ngIf="!viewOnly"
        class="gd-form-edit-questionnaire-v2-legend-items-item">
        <mat-icon>text_increase</mat-icon>
        <span>{{'LNG_QUESTIONNAIRE_TEMPLATE_QUESTION_ANSWER_BUTTON_ADD_NEW' | translate}}</span>
      </div>

      <!-- Edit -->
      <div
        *ngIf="!viewOnly"
        class="gd-form-edit-questionnaire-v2-legend-items-item">
        <mat-icon>edit</mat-icon>
        <span>{{'LNG_COMMON_BUTTON_UPDATE' | translate}}</span>
      </div>

    </div>

  </div>

</div>
