<div class="form-select-container form-element {{ tooltip ? 'form-select-tooltip' : '' }}"
     [id]="identifier" [ngClass]="{invalid: (invalid)}">

    <mat-form-field
        [class.display-filter-icon]="displayFilterIcon"
        [class.clearable]="clearable && !multiple && !disabled">

        <div
            *ngIf="displayFilterIcon"
            class="filter-icon">
            <span class="xt-icon">search</span>
        </div>

        <mat-select
            [class.filter-icon-input]="displayFilterIcon"
            #selectElement="ngModel"
            [(ngModel)]="value"
            [compareWith]="compareWith"
            [attr.name]="name"
            [required]="required"
            [placeholder]="placeholder"
            [multiple]="multiple"
            (blur)="onBlur()"
            [disabled]="disabled"
            (selectionChange)="onChange(selectElement.value)"
            [disableOptionCentering]="true">
            <mat-select-trigger>
                <div
                    *ngFor="let option of selectedOptions; let first = first"
                    class="custom-select-trigger-value">

                    {{ first ? '' : ', ' }}

                    <!-- Image -->
                    <img
                        *ngIf="optionLabelImgKey && option[optionLabelImgKey]"
                        height="13px"
                        [src]="option[optionLabelImgKey]"/>

                    <!-- Prefix -->
                    {{ optionLabelPrefixKey && option[optionLabelPrefixKey] ? (option[optionLabelPrefixKey] | translate) + optionLabelPrefixDelimiter : '' }}

                    <!-- Label -->
                    {{option[optionLabelKey] | translate}}
                </div>
            </mat-select-trigger>

            <!-- Option used to filter options -->
            <mat-option
                *ngIf="enableFilterOptions">
                <ngx-mat-select-search
                    [placeholderLabel]="filterOptionsPlaceholder | translate"
                    [noEntriesFoundLabel]="false"
                    [clearSearchInput]="true"
                    [(ngModel)]="searchedValue"
                    (ngModelChange)="filterOptions($event)"
                    [disableScrollToActiveOnOptionsChanged]="true"
                    [preventHomeEndKeyPropagation]="true">
                </ngx-mat-select-search>
            </mat-option>

            <!-- Empty option used to select nothing -->
            <mat-option
                *ngIf="clearable && !multiple"
                [value]="null">
                {{ noneLabel | translate }}
            </mat-option>

            <!-- Empty option used to select nothing -->
            <mat-option
                *ngFor="let option of filteredOptions"
                [value]="option[optionValueKey]"
                [matTooltip]="option[optionTooltipKey] | translate"
                [disabled]="(!allowSelectionOfDisabledItems && option[optionDisabledKey]) || optionReadOnly">

                <!-- Image -->
                <img
                    *ngIf="optionLabelImgKey && option[optionLabelImgKey]"
                    height="24px"
                    [src]="option[optionLabelImgKey]"/>

                <!-- Prefix -->
                {{ optionLabelPrefixKey && option[optionLabelPrefixKey] ? (option[optionLabelPrefixKey] | translate) + optionLabelPrefixDelimiter : '' }}

                <!-- Label -->
                {{option[optionLabelKey] | translate}}
            </mat-option>
        </mat-select>

        <span
            *ngIf="tooltip"
            #tooltipCtrl="matTooltip"
            [matTooltip]="tooltip"
            class="xt-icon form-icon"
            (click)="displayTooltip($event, tooltipCtrl)">
            help
        </span>
    </mat-form-field>

    <app-form-validation
        *ngIf="invalid"
        [controlContainer]="controlContainer"
        [controlName]="name"
        [messages]="failures">
    </app-form-validation>
</div>
